
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Trainer &#8212; GiGL  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css?v=1248dbba" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Inter:100,200,300,regular,500,600,700,800,900" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'components/trainer';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/gigl.png" class="logo__image only-light" alt=""/>
    <script>document.write(`<img src="../_static/gigl.png" class="logo__image only-dark" alt=""/>`);</script>
  
  
    <p class="title logo__title">GiGL</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../user_guide/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/snap-research/GiGL" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/gigl/" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary" tabindex="0">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item">
<nav class="navbar-nav">
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../user_guide/index.html">
                        User Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../reference/index.html">
                        API Reference
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/snap-research/GiGL" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/gigl/" title="PyPI" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-custom fa-pypi fa-lg" aria-hidden="true"></i></span>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Trainer</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="trainer">
<h1>Trainer<a class="headerlink" href="#trainer" title="Link to this heading">#</a></h1>
<p>The Trainer component reads the outputs of split generator (which paths are specified in the frozen config), and trains a GNN model on the training set, early stops on the performance of the validation set, and finally evaluates on the test set. The training logic is implemented with PyTorch Distributed Data Parallel (DDP) Training, which enables distributed training on multiple GPU cards across multiple worker nodes.</p>
</section>
<section id="input">
<h1>Input<a class="headerlink" href="#input" title="Link to this heading">#</a></h1>
<ul class="simple">
<li><p><strong>job_name</strong> (AppliedTaskIdentifier):  which uniquely identifies an end-to-end task.</p></li>
<li><p><strong>task_config_uri</strong> (Uri):  Path which points to a “template” <code class="docutils literal notranslate"><span class="pre">GbmlConfig</span></code> proto yaml file.</p></li>
<li><p><strong>resource_config_uri</strong> (Uri): Path which points to a <code class="docutils literal notranslate"><span class="pre">GiGLResourceConfig</span></code> yaml</p></li>
</ul>
</section>
<section id="what-does-it-do">
<h1>What does it do?<a class="headerlink" href="#what-does-it-do" title="Link to this heading">#</a></h1>
<p>The whole model training contains two main components: (i) the Trainer, which that sets up the environment, and (ii) a user-defined instance of <code class="docutils literal notranslate"><span class="pre">BaseTrainer</span></code> that contains the actual training loop w.r.t. the given task. For example, for node anchor-based link prediction, we have <code class="docutils literal notranslate"><span class="pre">NodeAnchorBasedLinkPredictionModelingTaskSpec</span></code>. Model training involves the following steps:</p>
<ul class="simple">
<li><p>The Trainer sets up the (optionally distributed) Torch training environment.</p></li>
<li><p>The Trainer reads <code class="docutils literal notranslate"><span class="pre">GraphMetadata</span></code> that was generated by the Data Preprocessor.</p></li>
<li><p>The Trainer initializes the <code class="docutils literal notranslate"><span class="pre">BaseTrainer</span></code> instance (instance specified at the <code class="docutils literal notranslate"><span class="pre">trainerClsPath</span></code> field in the <code class="docutils literal notranslate"><span class="pre">trainerConfig</span></code> section of the frozen <code class="docutils literal notranslate"><span class="pre">GbmlConfig</span></code>, and with arguments at <code class="docutils literal notranslate"><span class="pre">trainerArgs</span></code>) and initializes the GNN model.</p></li>
<li><p>We start model training as indicated by the <code class="docutils literal notranslate"><span class="pre">BaseTrainer</span></code> instance.  This may look something like:</p>
<ul>
<li><p>We initialize training and validation dataloaders (See: <code class="docutils literal notranslate"><span class="pre">NodeAnchorBasedLinkPredictionDatasetDataloaders</span></code> in <a class="reference internal" href="#../../python/gigl/src/common/types/pb_wrappers/dataset_metadata_utils.py"><span class="xref myst">dataset_metadata_utils.py</span></a>)</p></li>
<li><p>Follow a standard distributed training scheme: each worker loads a batch of data and performs the normal forward and backward passes for model training in a distributed way.</p></li>
<li><p>Every fixed number of training batches(<code class="docutils literal notranslate"><span class="pre">val_every_num_batches</span></code>), we evaluate the current model on the validation set with a fixed number of validation batches (<code class="docutils literal notranslate"><span class="pre">num_val_batches</span></code>)</p></li>
<li><p>We follow a standard early-stopping strategy on the validation performances on offline metrics, with a configurable patience parameter (<code class="docutils literal notranslate"><span class="pre">early_stop_patience</span></code>) or see <code class="docutils literal notranslate"><span class="pre">EarlyStopper</span></code> utility class in <a class="reference internal" href="#../../python/gigl/src/common/modeling_task_specs/utils/early_stop.py"><span class="xref myst">early_stop.py</span></a></p></li>
<li><p>When early-stopping is triggered to end the training process, we reload the saved model at the best validation batch, and run evaluation (test) it with a fixed number of test batches (<code class="docutils literal notranslate"><span class="pre">num_test_batches</span></code>).</p></li>
<li><p>At the end, we return the model and its test performance (offline metrics) back to the Trainer.</p></li>
</ul>
</li>
<li><p>The Trainer persists output metadata like model parameters and offline metrics (see <a class="reference internal" href="#output"><span class="xref myst">Output</span></a>).</p></li>
</ul>
</section>
<section id="how-do-i-run-it">
<h1>How do I run it?<a class="headerlink" href="#how-do-i-run-it" title="Link to this heading">#</a></h1>
<p><strong>Import GiGL</strong></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">gigl.src.split_generator.split_generator</span> <span class="kn">import</span> <span class="n">SplitGenerator</span>
<span class="kn">from</span> <span class="nn">gigl.common</span> <span class="kn">import</span> <span class="n">UriFactory</span>
<span class="kn">from</span> <span class="nn">gigl.src.common.types</span> <span class="kn">import</span> <span class="n">AppliedTaskIdentifier</span>

<span class="n">trainer</span> <span class="o">=</span> <span class="n">Trainer</span><span class="p">()</span>

<span class="n">trainer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">applied_task_identifier</span><span class="o">=</span><span class="n">AppliedTaskIdentifier</span><span class="p">(</span><span class="s2">&quot;my_gigl_job_name&quot;</span><span class="p">),</span>
    <span class="n">task_config_uri</span><span class="o">=</span><span class="n">UriFactory</span><span class="o">.</span><span class="n">create_uri</span><span class="p">(</span><span class="s2">&quot;gs://my-temp-assets-bucket/task_config.yaml&quot;</span><span class="p">),</span>
    <span class="n">resource_config_uri</span><span class="o">=</span><span class="n">UriFactory</span><span class="o">.</span><span class="n">create_uri</span><span class="p">(</span><span class="s2">&quot;gs://my-temp-assets-bucket/resource_config.yaml&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note: If you are training on VertexAI and using a custom class, you will have to provide a docker image (Either <code class="docutils literal notranslate"><span class="pre">cuda_docker_uri</span></code> for GPU training or <code class="docutils literal notranslate"><span class="pre">cpu_docker_uri</span></code> for CPU training.)</p>
<p><strong>Command Line</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="o">-</span><span class="n">m</span> \
    <span class="n">gigl</span><span class="o">.</span><span class="n">src</span><span class="o">.</span><span class="n">training</span><span class="o">.</span><span class="n">trainer</span> \
    <span class="o">--</span><span class="n">job_name</span> <span class="n">my_gigl_job_name</span> \
    <span class="o">--</span><span class="n">task_config_uri</span> <span class="s2">&quot;gs://my-temp-assets-bucket/task_config.yaml&quot;</span>
    <span class="o">--</span><span class="n">resource_config_uri</span><span class="o">=</span><span class="s2">&quot;gs://my-temp-assets-bucket/resource_config.yaml&quot;</span>
</pre></div>
</div>
</section>
<section id="output">
<h1>Output<a class="headerlink" href="#output" title="Link to this heading">#</a></h1>
<p>Ater the training process finishes:</p>
<ul class="simple">
<li><p>The Trainer saves the trained model’s <code class="docutils literal notranslate"><span class="pre">state_dict</span></code> at specified location (<code class="docutils literal notranslate"><span class="pre">trainedModelUri</span></code> field of <code class="docutils literal notranslate"><span class="pre">sharedConfig.trainedModelMetadata</span></code>).</p></li>
<li><p>The trainer logs training metrics to <code class="docutils literal notranslate"><span class="pre">trainingLogsUri</span></code> field of <code class="docutils literal notranslate"><span class="pre">sharedConfig.trainedModelMetadata</span></code>. To view the metrics on your local, you can run the command: <code class="docutils literal notranslate"><span class="pre">tensorboard</span> <span class="pre">--logdir</span> <span class="pre">gs://tensorboard_logs_uri_here</span></code></p></li>
</ul>
</section>
<section id="custom-usage">
<h1>Custom Usage<a class="headerlink" href="#custom-usage" title="Link to this heading">#</a></h1>
<p>The Trainer is designed to be task-agnostic, with the detailed model and training logics specified in the user-provided <code class="docutils literal notranslate"><span class="pre">BaseTrainer</span></code> instance.  Modifying the <code class="docutils literal notranslate"><span class="pre">BaseTrainer</span></code> instance allows maximal flexibility in changing model architecture and training parameters.</p>
</section>
<section id="other">
<h1>Other<a class="headerlink" href="#other" title="Link to this heading">#</a></h1>
<section id="torch-profiler">
<h2>Torch Profiler<a class="headerlink" href="#torch-profiler" title="Link to this heading">#</a></h2>
<p>You can profile trainer performance metrics, such as gpu/cpu utilization by adding below to task_config.yaml</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">profilerConfig</span><span class="p">:</span>
    <span class="n">should_enable_profiler</span><span class="p">:</span> <span class="n">true</span>
    <span class="n">profiler_log_dir</span><span class="p">:</span> <span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">path_to_my_bucket</span>  <span class="p">(</span><span class="ow">or</span> <span class="n">a</span> <span class="n">local</span> <span class="nb">dir</span><span class="p">)</span>
    <span class="n">profiler_args</span><span class="p">:</span>
        <span class="n">wait</span><span class="p">:</span><span class="s1">&#39;0&#39;</span>
        <span class="n">with_stack</span><span class="p">:</span> <span class="s1">&#39;True&#39;</span>
</pre></div>
</div>
</section>
<section id="monitoring-and-logging">
<h2>Monitoring and logging<a class="headerlink" href="#monitoring-and-logging" title="Link to this heading">#</a></h2>
<p>Once the trainer component starts, the training process can be monitored via the gcloud console under Vertex AI Custom Jobs (<code class="docutils literal notranslate"><span class="pre">https://console.cloud.google.com/vertex-ai/training/custom-jobs?project=&lt;project_name_here&gt;</span></code>). You can also view the job name, status, jobspec, and more using <code class="docutils literal notranslate"><span class="pre">gcloud</span> <span class="pre">ai</span> <span class="pre">custom-jobs</span> <span class="pre">list</span> <span class="pre">--project</span> <span class="pre">&lt;project_name_here&gt;</span></code></p>
<p>On the Vertex AI UI, you can see all the information like machine/acceleratior information, CPU Utilization, GPU utiliization, Network data etc. Here, you will also find the “View logs” tab, which will open the Stackdriver for your job which logs everything from your modeling task spec as the training progresses in real time.</p>
<p>If you would like to view the logs locally, you can also use: <code class="docutils literal notranslate"><span class="pre">gcloud</span> <span class="pre">ai</span> <span class="pre">custom-jobs</span> <span class="pre">stream-logs</span> <span class="pre">&lt;custom</span> <span class="pre">job</span> <span class="pre">ID&gt;</span> <span class="pre">--project=&lt;project_name_here&gt;</span> <span class="pre">--region=&lt;region</span> <span class="pre">here&gt;</span></code>.</p>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">#</a></h2>
<p>Following are all of the Trainer parameters that can be configured within the config yaml, along with short explanations.</p>
<ul>
<li><p>Training environment parameters (number of workers for different dataloaders)</p>
<ul class="simple">
<li><p>train_main_sample_num_workers</p></li>
<li><p>train_random_sample_num_workers</p></li>
<li><p>val_main_sample_num_workers</p></li>
<li><p>val_random_sample_num_workers</p></li>
<li><p>test_main_sample_num_workers</p></li>
<li><p>test_random_sample_num_workers</p></li>
</ul>
<p>Note that training involves multiple dataloaders simultaneously.  Take care to specify these parameters in a way which avoids overburdening your machine.  It is recommended to specify <code class="docutils literal notranslate"><span class="pre">(train_main_sample_num_workers</span> <span class="pre">+</span> <span class="pre">train_random_sample_num_workers</span> <span class="pre">+</span> <span class="pre">val_main_sample_num_workers</span> <span class="pre">+</span> <span class="pre">val_random_sample_num_workers</span> <span class="pre">&lt;</span> <span class="pre">num_cpus)</span></code>, and <code class="docutils literal notranslate"><span class="pre">(test_main_sample_num_workers</span> <span class="pre">+</span> <span class="pre">test_random_sample_num_workers</span> <span class="pre">&lt;</span> <span class="pre">num_cpus)</span></code> to avoid training stalling due to contention.</p>
</li>
<li><p>Training parameters:</p>
<ul class="simple">
<li><p>margin: margin for the margin loss</p></li>
<li><p>loss_function: choice of training loss function, options <code class="docutils literal notranslate"><span class="pre">margin</span></code> and <code class="docutils literal notranslate"><span class="pre">softmax</span></code></p></li>
<li><p>softmax_temperature: temperature parameter in the <code class="docutils literal notranslate"><span class="pre">softmax</span></code> loss</p></li>
<li><p>optim_lr: learning rate of the optimizer</p></li>
<li><p>optim_weight_decay: weight decay of the optimizer</p></li>
<li><p>val_every_num_batches: validation frequence per training batches</p></li>
<li><p>num_val_batches: number of validation batches</p></li>
<li><p>num_test_batches: number of testing batches</p></li>
<li><p>Early_stop_patience: patience for earlystopping</p></li>
<li><p>main_sample_batch_size: training batch size</p></li>
<li><p>random_negative_sample_batch_size: random negative sample batch size for training</p></li>
<li><p>random_negative_sample_batch_size_for_evaluation: random negative sample batch size for evaluation</p></li>
</ul>
</li>
<li><p>Model parameters:</p>
<ul class="simple">
<li><p>should_l2_normalize_output: whether apply L2 normalization on the output embeddings</p></li>
<li><p>num_layers: number of layers in the GNN (this should be the same as numHops under subgraphSamplerConfig)</p></li>
<li><p>in_dim: dimension of the input node feature</p></li>
<li><p>hid_dim: dimension of the hidden layers</p></li>
<li><p>out_dim: dimension of the output embeddings</p></li>
</ul>
</li>
<li><p>Modifying the GNN model:</p>
<ul class="simple">
<li><p>Currently the GNN models are defined <a class="reference internal" href="#/python/gigl/src/common/models/pyg/homogeneous.py"><span class="xref myst">here</span></a> and initialized in the <code class="docutils literal notranslate"><span class="pre">init_model</span></code> function in ModelingTaskSpec. When trying different GNN models, it is recommended to also include the new GNN architectures under the same file and declare them as is currently done. This cannot currently be done from the default <code class="docutils literal notranslate"><span class="pre">GbmlConfig</span></code> yaml.</p></li>
</ul>
</li>
</ul>
</section>
<section id="background-for-distributed-training">
<h2>Background for distributed training<a class="headerlink" href="#background-for-distributed-training" title="Link to this heading">#</a></h2>
<p>Trainer currently uses PyTorch distributed training abstractions  to enable multi-node and multi-GPU training. Some useful terminology and links to learn about these abstractions below.</p>
<ul class="simple">
<li><p><strong>WORLD</strong>: Group of processes/workers that are used for distributed training.</p></li>
<li><p><strong>WORLD_SIZE</strong>:  The number of processes/workers in the distributed training WORLD.</p></li>
<li><p><strong>RANK</strong>: The unique id (usually index) of the process/worker in the distributed training WORLD.</p></li>
<li><p><strong>Data loader worker</strong>: A worker used specifically for loading data; if the dataloader worker is utilizing the same thread/process as a worker in distributed training WORLD, then we may incur blocking execution of training, resulting in slowdowns.</p></li>
<li><p><strong><a class="reference external" href="https://pytorch.org/tutorials/intermediate/ddp_tutorial.html">Distributed Data Parallel</a></strong>: Pytorch’s version of <a class="reference external" href="https://en.wikipedia.org/wiki/Data_parallelism">Data parallalism</a> across different <strong>processes</strong> (could even be processes on different machines), to speed up traiing on large datasets.</p></li>
<li><p><strong><a class="reference external" href="https://pytorch.org/docs/stable/distributed.html">TORCH.DISTRIBUTED package</a></strong>: A torch package containing tools for distributed communication and trainings.</p>
<ul>
<li><p>Defines <a class="reference external" href="https://pytorch.org/docs/stable/distributed.html#backends">backends for distributed communication</a> like <code class="docutils literal notranslate"><span class="pre">gloo</span></code> and <code class="docutils literal notranslate"><span class="pre">nccl</span></code> - as a ML practitioner you should not worry about how these work, but important to know what <strong>devices</strong> and <strong>collective functions</strong> they support.</p></li>
<li><p>Contains <strong>“<a class="reference external" href="https://pytorch.org/docs/stable/distributed.html#collective-functions">Collective functions</a>”</strong> like <code class="docutils literal notranslate"><span class="pre">torch.distributed.broadcast</span></code>, <code class="docutils literal notranslate"><span class="pre">torch.distributed.all_gather</span></code>, et al. which allow communication of tensors across the <strong>WORLD</strong>.</p></li>
</ul>
</li>
</ul>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Trainer</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#input">Input</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#what-does-it-do">What does it do?</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#how-do-i-run-it">How do I run it?</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#output">Output</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#custom-usage">Custom Usage</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#other">Other</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#torch-profiler">Torch Profiler</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#monitoring-and-logging">Monitoring and logging</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#background-for-distributed-training">Background for distributed training</a></li>
</ul>
</li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">

  <div class="tocsection sourcelink">
    <a href="../_sources/components/trainer.md.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2025, Snap Inc.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.2.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>